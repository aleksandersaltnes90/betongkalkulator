<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>Betongkalkulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/static/style.css">
</head>
<body>

<h1>ğŸ§± Betongkalkulator</h1>

<div class="card">

<h2>Hva skal du stÃ¸pe?</h2>
<select id="bruksomrÃ¥de" onchange="velgBruksomrÃ¥de()">
  <option value="">Velgâ€¦</option>
  <option value="gang">Gangsti / platting</option>
  <option value="terrasse">Terrasse</option>
  <option value="garasje">Garasjegulv</option>
  <option value="mur">StÃ¸ttemur</option>
  <option value="fundament">Fundament / sÃ¥le</option>
  <option value="bad">Badegulv</option>
  <option value="innvendig">Innvendig gulv</option>
  <option value="rehab">Planering / rehabilitering</option>
</select>

<h2>Underlag / oppbygning</h2>
<div class="radio-group" onchange="oppdater()">
  <label><input type="radio" name="underlag" value="pukk" checked> Komprimert pukk</label>
  <label><input type="radio" name="underlag" value="isolert"> Pukk + isolasjon (XPS/EPS)</label>
  <label><input type="radio" name="underlag" value="eksisterende"> Eksisterende betong</label>
  <label><input type="radio" name="underlag" value="darlig"> Uavklart / dÃ¥rlig grunn</label>
</div>

<div id="vurdering" class="vurdering ok">
  Velg bruksomrÃ¥de for vurdering
</div>

<div class="plan">
  <div id="rektangel">0.00 mÂ²</div>
  <div class="plan-info">
    <span id="areal">Areal: 0.00 mÂ²</span>
    <span id="volum">Volum: 0.00 mÂ³</span>
  </div>
</div>

<div class="chips" id="chips"></div>

<div class="info-panel" id="infoPanel">
  <div class="info-header">
    <strong id="infoTitle"></strong>
    <button onclick="lukkInfo()">âœ•</button>
  </div>
  <div id="infoText"></div>
</div>

<div class="slider-row">
  <label>Lengde (m)</label>
  <input type="range" id="lengdeRange" min="0" max="20" step="0.1" value="2" oninput="sync('lengde')">
  <input type="number" id="lengde" value="2" step="0.1" oninput="sync('lengde',true)">
</div>

<div class="slider-row">
  <label>Bredde (m)</label>
  <input type="range" id="breddeRange" min="0" max="20" step="0.1" value="2" oninput="sync('bredde')">
  <input type="number" id="bredde" value="2" step="0.1" oninput="sync('bredde',true)">
</div>

<div class="slider-row">
  <label>Tykkelse (cm)</label>
  <input type="range" id="tykkelseRange" min="1" max="50" step="1" value="10" oninput="sync('tykkelse')">
  <input type="number" id="tykkelse" value="10" oninput="sync('tykkelse',true)">
</div>

<h2>Materiale</h2>
<div class="betong">
  <div class="mat-wrap" data-mat="B20"><span class="lock">ğŸ”’</span><img src="/static/b20.png" onclick="forsokVelg('B20',this)"></div>
  <div class="mat-wrap" data-mat="B30"><span class="lock">ğŸ”’</span><img src="/static/b30.png" onclick="forsokVelg('B30',this)"></div>
  <div class="mat-wrap" data-mat="B35"><span class="lock">ğŸ”’</span><img src="/static/b35.png" class="aktiv" onclick="forsokVelg('B35',this)"></div>
  <div class="mat-wrap" data-mat="MEGAPLAN"><span class="lock">ğŸ”’</span><img src="/static/avrett.png" onclick="forsokVelg('MEGAPLAN',this)"></div>
</div>

<button id="beregnBtn" onclick="beregn()">
  <span id="btnText">Beregn</span>
  <span id="spinner" class="spinner skjult"></span>
</button>

</div>

<div class="resultat">
  <div id="output">Fyll inn verdier og trykk Beregn</div>
</div>

<button class="feedback-btn" onclick="Ã¥pneFeedback()">
  ğŸ’¬ Gi feedback
</button>

<div id="feedbackModal" class="modal">
  <div class="modal-content">
    <h3>Gi feedback</h3>
    <textarea id="feedbackText" placeholder="Ris, ros eller forslagâ€¦"></textarea>
    <div class="modal-actions">
      <button onclick="sendFeedback()">Send</button>
      <button onclick="lukkFeedback()">Avbryt</button>
    </div>
    <div id="feedbackStatus"></div>
  </div>
</div>

<footer>
  Â© 2026 Aleksander Saltnes Â· Betongkalkulator v1.0<br>
  <span class="price-info">Priser oppdatert 07.01.2026 â€“ Byggmax / Megaflis</span>
</footer>

<script>
function Ã¥pneFeedback(){
  feedbackModal.classList.add("vis");
}

function lukkFeedback(){
  feedbackModal.classList.remove("vis");
  feedbackStatus.innerText="";
  feedbackText.value="";
}

function sendFeedback(){
  const tekst = feedbackText.value.trim();
  if(!tekst){
    feedbackStatus.innerText="Skriv noe fÃ¸rst ğŸ™‚";
    return;
  }

  fetch("/feedback",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ tekst })
  })
  .then(()=> {
    feedbackStatus.innerText="Takk for tilbakemeldingen ğŸ™Œ";
    setTimeout(lukkFeedback,1500);
  })
  .catch(()=>{
    feedbackStatus.innerText="Noe gikk galt â€“ prÃ¸v igjen";
  });
}


let valgtMateriale="B35";

const BRUK={
 gang:{tillatt:["B20","B30","B35"]},
 terrasse:{tillatt:["B30","B35"]},
 garasje:{tillatt:["B35"]},
 mur:{tillatt:["B35"]},
 fundament:{tillatt:["B35"]},
 bad:{tillatt:["MEGAPLAN"]},
 innvendig:{tillatt:["MEGAPLAN","B20"]},
 rehab:{tillatt:["MEGAPLAN"]}
};

function underlag(){return document.querySelector("input[name='underlag']:checked").value;}

function sync(n,from=false){
 const r=document.getElementById(n+"Range"),i=document.getElementById(n);
 from?r.value=i.value:i.value=r.value;oppdater();
}

function velgBruksomrÃ¥de(){oppdaterMaterialvalg();oppdater();}

function oppdaterMaterialvalg(){
 const o=bruksomrÃ¥de.value;
 document.querySelectorAll(".mat-wrap").forEach(w=>{
  w.classList.toggle("locked",o && !BRUK[o].tillatt.includes(w.dataset.mat));
 });
 if(o && !BRUK[o].tillatt.includes(valgtMateriale)){
  const ny=BRUK[o].tillatt[0];
  velgMateriale(ny,document.querySelector(`.mat-wrap[data-mat="${ny}"] img`));
 }
}

function oppdater(){
 const l=+lengde.value||0,b=+bredde.value||0,t=+tykkelse.value||0;
 const a=l*b,v=a*(t/100);
 areal.innerText=`Areal: ${a.toFixed(2)} mÂ²`;
 volum.innerText=`Volum: ${v.toFixed(3)} mÂ³`;
 rektangel.style.width=Math.max(l*30,40)+"px";
 rektangel.style.height=Math.max(b*30,40)+"px";
 rektangel.innerText=a.toFixed(2)+" mÂ²";
 vurderOppsett(v,t);
}

function forsokVelg(m,img){
 if(img.parentElement.classList.contains("locked")){
  visInfo("Materialet er ikke egnet",forklaringMateriale(m));return;
 }
 velgMateriale(m,img);
}

function velgMateriale(m,img){
 valgtMateriale=m;
 document.querySelectorAll(".betong img").forEach(i=>i.classList.remove("aktiv"));
 img.classList.add("aktiv");oppdater();
}

function armering(mat,t){
 if(mat==="MEGAPLAN")
  return "ğŸ§µ Fiberarmert avrettingsmasse â€“ ingen armeringsnett. >5 cm legges i flere lag.";
 if(underlag()==="darlig")
  return "ğŸ”© DÃ¥rlig grunn â€“ anbefalt K257 eller tettere armering.";
 if(t<7) return "âŒ For tynn stÃ¸p â€“ hÃ¸y sprekkfare.";
 if(t<10) return "ğŸ”© Lett armering: K131 eller fiberbetong.";
 if(t<=12) return "ğŸ”© Anbefalt armering: K189.";
 return "ğŸ”© Kraftig armering: K257 / Ã˜8â€“Ã˜10 c/c 200 mm.";
}

function vurderOppsett(volum,tykkelse){
 chips.innerHTML="";
 if(!bruksomrÃ¥de.value){
  vurdering.innerText="Velg bruksomrÃ¥de for vurdering";
  beregnBtn.disabled=true;return;
 }
 beregnBtn.disabled=false;
 vurdering.innerText="âœ… Anbefalt lÃ¸sning";
 chips.innerHTML+=chip("Armering / oppbygning",armering(valgtMateriale,tykkelse));
 if(underlag()==="eksisterende")
  chips.innerHTML+=chip("Heft","Eksisterende betong krever rens og heftbro.");
 if(underlag()==="pukk" && bruksomrÃ¥de.value!=="innvendig")
  chips.innerHTML+=chip("Frost","Uisolert plate â€“ vurder isolasjon.");
 if(valgtMateriale!=="MEGAPLAN" && volum>1.5)
  chips.innerHTML+=chip("Ferdigbetong","StÃ¸rre volum â€“ vurder ferdigbetong.");
}

function forklaringMateriale(m){
 return{
  B20:"Lav styrke. Kun lette gangareal.",
  B30:"God allround betong for platting/terrasse.",
  B35:"HÃ¸y styrke â€“ nÃ¸dvendig for garasje, mur og fundament.",
  MEGAPLAN:"Avrettingsmasse â€“ ikke konstruktiv."
 }[m];
}

function chip(t,x){return `<div class="chip warn" onclick="visInfo('${t}','${x}')">${t}</div>`;}
function visInfo(t,x){infoTitle.innerText=t;infoText.innerText=x;infoPanel.classList.add("vis");}
function lukkInfo(){infoPanel.classList.remove("vis");}

function beregn(){
 beregnBtn.disabled=true;btnText.innerText="Beregnerâ€¦";
 spinner.classList.remove("skjult");
 setTimeout(()=>{
  fetch("/beregn",{method:"POST",headers:{"Content-Type":"application/json"},
  body:JSON.stringify({
   lengde:lengde.value,bredde:bredde.value,
   tykkelse:tykkelse.value,materiale:valgtMateriale
  })})
  .then(r=>r.json())
  .then(d=>{
   output.innerHTML=
    `Areal: ${d.areal} mÂ²<br>
     Volum: ${d.volum} mÂ³<br>
     Sekker: ${d.sekker}<br>
     Pris: <b>${d.pris} kr</b><br><br>
     <span class="ps">${d.ps}</span>`;
  })
  .finally(()=>{
   spinner.classList.add("skjult");
   btnText.innerText="Beregn";
   beregnBtn.disabled=false;
  });
 },1000);
}

oppdater();
</script>
</body>
</html>
